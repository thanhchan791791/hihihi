<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>üêæ Ch·ªçn Ch√≥ Theo C·∫£m X√∫c</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Quicksand', sans-serif;
      background: linear-gradient(to bottom right, #fff7f0, #ffe8e8);
      margin:0; padding:0;
      min-height:100vh;
      display:flex; flex-direction:column;
      justify-content:center; align-items:center;
      text-align:center; overflow-x:hidden;
    }
    h1 { color:#ff6f61; font-size:2.4rem; margin:30px 0 20px; animation: fadeIn 1.2s ease; }
    .emotion-buttons {
      display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
      gap:20px; width:100%; max-width:550px; padding:0 20px;
    }
    .emotion-card {
      background:#ff8fa3; color:white; padding:24px 18px; border-radius:28px;
      font-size:1.2rem; font-weight:bold; cursor:pointer;
      box-shadow:0 8px 24px rgba(0,0,0,0.12);
      display:flex; flex-direction:column; align-items:center;
      animation: floatBox 3.5s ease-in-out infinite;
      transition: transform 0.3s ease, background 0.3s ease;
    }
    .emotion-card:hover { transform: scale(1.1) rotate(1.5deg); background:#f85775; box-shadow:0 10px 30px rgba(0,0,0,0.15); }
    .emotion-icon { font-size:2.2rem; margin-bottom:8px; }
    #loading { display:none; font-size:1.2rem; color:#777; margin-top:20px; }
    #dogContainer { text-align:center; margin-top:40px; animation:fadeIn 1s ease; }
    .dog-img { width:100%; max-width:320px; border-radius:24px; margin-top:20px; animation:fadeInScale 1s ease; box-shadow:0 10px 28px rgba(0,0,0,0.15); transition: transform 0.4s ease; }
    .dog-img:hover { transform: scale(1.05); }
    .dog-name {
      font-size:2.4rem; font-weight:800; margin-top:14px;
      background:linear-gradient(90deg,#ff6f61,#ffcc33);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      text-shadow:0 0 8px rgba(255,111,97,0.7),0 0 12px rgba(255,204,51,0.5);
      white-space:nowrap; overflow:hidden; border-right:2px solid #d62828; width:0;
      animation:typeWriter 2s steps(30,end) forwards, popUp 0.6s ease forwards 2s;
    }
    .healing-message-wrapper { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:999; opacity:1; animation: slideIn 0.8s ease, fadeOut 6s ease forwards; }
    .healing-message { font-size:1.4rem; font-weight:600; color:#d62828; background:#fff0f3; padding:22px 28px; border-radius:26px; box-shadow:0 10px 28px rgba(0,0,0,0.12); max-width:90vw; }
    .support-message { font-size:1rem; color:#555; margin-top:12px; background-color:#ffffffcc; padding:8px 14px; border-radius:14px; box-shadow:0 6px 16px rgba(0,0,0,0.1); display:inline-block; max-width:80%; }
    @keyframes floatBox {0%,100%{transform:translateY(0);}50%{transform:translateY(-6px);} }
    @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
    @keyframes fadeInScale { from{opacity:0;transform:scale(0.9);} to{opacity:1;transform:scale(1);} }
    @keyframes popUp {0%{transform:scale(0.8);opacity:0;}50%{transform:scale(1.2);opacity:1;}100%{transform:scale(1);opacity:1;} }
    @keyframes typeWriter { from{width:0;} to{width:100%;} }
    @keyframes slideIn { from{opacity:0; transform:translate(-50%,-20%);} to{opacity:1; transform:translate(-50%,-50%);} }
    @keyframes fadeOut { 0%,70%{opacity:1;} 100%{opacity:0;} }
  </style>
</head>
<body>
  <h1>B·∫°n ƒêang C·∫£m Th·∫•y Th·∫ø N√†o ·∫°?</h1>
  <div class="emotion-buttons">
    <div class="emotion-card" onclick="loadDogs('Vui')"><div class="emotion-icon">üòä</div>Vui</div>
    <div class="emotion-card" onclick="loadDogs('M·ªát m·ªèi')"><div class="emotion-icon">üò©</div>M·ªát m·ªèi</div>
    <div class="emotion-card" onclick="loadDogs('Bu·ªìn nh·∫π')"><div class="emotion-icon">üòî</div>Bu·ªìn nh·∫π</div>
    <div class="emotion-card" onclick="loadDogs('C√¥ ƒë∆°n')"><div class="emotion-icon">üò¢</div>C√¥ ƒë∆°n</div>
    <div class="emotion-card" onclick="loadDogs('B·ª±c m√¨nh')"><div class="emotion-icon">üò†</div>B·ª±c m√¨nh</div>
    <div class="emotion-card" onclick="loadDogs('C·∫ßn ƒë∆∞·ª£c y√™u th∆∞∆°ng')"><div class="emotion-icon">ü•∫</div>C·∫ßn ƒë∆∞·ª£c y√™u th∆∞∆°ng</div>
  </div>
  <div id="loading">ƒêang t√¨m b√© ph√π h·ª£p...</div>
  <div id="dogContainer"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBNB1acbPtKox8eTjth3FtWuDOLhueRIys",
  authDomain: "dogs-be72b.firebaseapp.com",
  databaseURL: "https://dogs-be72b-default-rtdb.firebaseio.com",
  projectId: "dogs-be72b",
  storageBucket: "dogs-be72b.appspot.com",
  messagingSenderId: "1003873040746",
  appId: "1:1003873040746:web:607f4ff587afc430d3cd13"
};
firebase.initializeApp(firebaseConfig);

const healingTexts = {
  "Vui":[name=>`‚ù§Ô∏è ${name} c≈©ng ƒëang vui nh∆∞ b·∫°n!`, name=>`üåü ${name} mu·ªën c√πng b·∫°n c∆∞·ªùi to!`, name=>`üòÑ ${name} vui qu√° mu·ªën g√≥i b·∫°n v√†o ni·ªÅm h·∫°nh ph√∫c!`],
  "M·ªát m·ªèi":[name=>`üí§ ${name} s·∫Ω c√πng b·∫°n ngh·ªâ ng∆°i.`, name=>`‚òï ${name} ng·ªìi b√™n b·∫°n th∆∞ gi√£n.`, name=>`üòå ${name} hi·ªÉu b·∫°n m·ªát m·ªèi, h√≠t th·ªü s√¢u nh√©!`],
  "Bu·ªìn nh·∫π":[name=>`üíñ ${name} s·∫Ω ng·ªìi b√™n b·∫°n v√† l·∫Øng nghe.`, name=>`üò¢ ${name} hi·ªÉu n·ªói bu·ªìn nh·ªè n√†y.`, name=>`üåà ${name} mang √°nh s√°ng d·ªãu d√†ng ƒë·∫øn tr√°i tim b·∫°n.`],
  "C√¥ ƒë∆°n":[name=>`ü§ó ${name} ƒë√£ ƒë·ª£i b·∫°n c·∫£ ng√†y.`, name=>`üêæ ${name} ƒë·∫øn c√πng b·∫°n ƒëi d·∫°o.`, name=>`üíå ${name} √¥m b·∫°n t·ª´ xa, ·∫•m √°p tr√†n v·ªÅ.`],
  "B·ª±c m√¨nh":[name=>`üò§ ${name} hi·ªÉu b·∫°n ƒëang kh√¥ng vui.`, name=>`üí® ${name} c√πng b·∫°n x·∫£ stress.`, name=>`üåø ${name} mang nƒÉng l∆∞·ª£ng nh·∫π nh√†ng gi√∫p b·∫°n b√¨nh tƒ©nh.`],
  "C·∫ßn ƒë∆∞·ª£c y√™u th∆∞∆°ng":[name=>`‚ù§Ô∏è ${name} s·∫Ω √¥m b·∫°n th·∫≠t ch·∫∑t.`, name=>`üíå ${name} nh·∫Øc b·∫°n b·∫°n quan tr·ªçng v√† ƒë∆∞·ª£c y√™u th∆∞∆°ng.`, name=>`üå∏ ${name} mu·ªën b·∫°n c·∫£m nh·∫≠n ·∫•m √°p v√† an to√†n.`]
};

const telegramBotToken="7807531189:AAGhMQ9jjew7Q9ywMDSTaGDy4Ns6XtPQUrI";
const telegramChatId="-4831972836";
const customerPosition=(window.location.hash||"").replace("#","");

function sendTelegramNotification(emotion,dogName){
  const posText = customerPosition?` (v·ªã tr√≠: ${customerPosition})`:"";
  const message=`KH√ÅCH c·∫£m th·∫•y "${emotion}"${posText}. H√£y ship ngay "${dogName}" ƒë·∫øn kh√°ch üíñ`;
  fetch(`https://api.telegram.org/bot${telegramBotToken}/sendMessage`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({chat_id:telegramChatId,text:message})
  }).then(res=>res.json()).then(data=>console.log("Telegram sent:",data))
  .catch(err=>console.error("Telegram error:",err));
}

function showConfetti(){
  const duration=3000; const animationEnd=Date.now()+duration;
  const defaults={startVelocity:30, spread:360, ticks:60, zIndex:9999};
  const interval=setInterval(()=>{
    const timeLeft=animationEnd-Date.now();
    if(timeLeft<=0) return clearInterval(interval);
    const particleCount=50*(timeLeft/duration);
    confetti(Object.assign({},defaults,{particleCount,origin:{x:Math.random(),y:Math.random()-0.2}}));
  },250);
}

function showCooldownMessage(remainingText){
  const wrapper=document.createElement("div"); wrapper.className="healing-message-wrapper";
  const msg=document.createElement("div"); msg.className="healing-message";
  msg.innerText=`‚è≥ B·∫°n vui l√≤ng quay l·∫°i sau ${remainingText} nh√©!`;
  wrapper.appendChild(msg); document.body.appendChild(wrapper);
  setTimeout(()=>wrapper.remove(),5000);
}

function canSelectEmotion(){
  const lastTime=localStorage.getItem("lastEmotionTime");
  if(!lastTime) return { allowed:true };
  const now=Date.now();
  const THIRTY_MINUTES=30*60*1000;
  const timePassed=now-parseInt(lastTime);
  if(timePassed>=THIRTY_MINUTES) return { allowed:true };
  const remaining=THIRTY_MINUTES-timePassed;
  const minutes=Math.floor(remaining/60000);
  const seconds=Math.floor((remaining%60000)/1000);
  return { allowed:false, remainingText:`${minutes} ph√∫t ${seconds<10?'0':''}${seconds} gi√¢y` };
}

function loadDogs(emotion){
  const check=canSelectEmotion();
  if(!check.allowed){ showCooldownMessage(check.remainingText); return; }
  localStorage.setItem("lastEmotionTime",Date.now().toString());

  document.querySelector(".emotion-buttons").style.display="none";
  document.querySelector("h1").style.display="none";
  document.getElementById("dogContainer").innerHTML="";
  document.getElementById("loading").style.display="block";

  firebase.database().ref("dogs").once("value",snapshot=>{
    const data=snapshot.val();
    const list=Object.values(data).filter(dog=>dog.emotion && dog.emotion.toLowerCase().includes(emotion.toLowerCase()));
    document.getElementById("loading").style.display="none";
    const container=document.getElementById("dogContainer");

    if(list.length===0){ container.innerHTML="<p>Kh√¥ng t√¨m th·∫•y b√© n√†o ph√π h·ª£p c·∫£m x√∫c n√†y üê∂</p>"; return; }

    const dog=list[Math.floor(Math.random()*list.length)];
    const texts = healingTexts[emotion];
    const text = texts[Math.floor(Math.random()*texts.length)](dog.name);

    const wrapper=document.createElement("div"); wrapper.className="healing-message-wrapper";
    const msg=document.createElement("div"); msg.className="healing-message"; msg.innerText=text;
    const support=document.createElement("div"); support.className="support-message"; support.innerText="üí¨ Nh√¢n vi√™n s·∫Ω h·ªó tr·ª£ b·∫°n sau v√†i ph√∫t nh√©!";
    wrapper.appendChild(msg); wrapper.appendChild(support); document.body.appendChild(wrapper);

    setTimeout(()=>{ wrapper.classList.add("fade-out"); showConfetti(); },7000);

    const dogBox=document.createElement("div"); dogBox.className="dog-box";
    const img=document.createElement("img"); img.src=`../${dog.image}`; img.className="dog-img";
    const name=document.createElement("div"); name.className="dog-name"; name.innerText=dog.name;
    dogBox.appendChild(img); dogBox.appendChild(name); container.appendChild(dogBox);

    sendTelegramNotification(emotion,dog.name);
  });
}
</script>
</body>
</html>
