<!-- TO√ÄN B·ªò CODE HTML - KH√îNG B·ªä B·ªé PH·∫¶N N√ÄO - ƒê√É G·ªòP CH·ª®C NƒÇNG CH·ªú 10 PH√öT CHUNG -->
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ch·ªçn ch√≥ ch·ª•p ·∫£nh</title>

  <!-- Bootstrap + FontAwesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
  body {
    font-family: 'Comic Sans MS', cursive;
    background: linear-gradient(to bottom, #fffafc, #ffeef5);
    margin: 0;
    padding: 20px 20px 100px;
    text-align: center;
  }

  h1 {
    font-size: 2em;
    color: #ff69b4;
    margin-bottom: 10px;
  }

  #search-input {
    width: 90%;
    max-width: 400px;
    padding: 12px 20px;
    font-size: 1em;
    border-radius: 30px;
    border: 2px solid #ffd6e6;
    background-color: #fff0f7;
    color: #d94f85;
  }

  #seat-info {
    margin-top: 10px;
    font-weight: bold;
    color: #d94f85;
    font-size: 1.1em;
  }

  #dog-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
  }

  .dog-card {
    background: #fff0f5;
    padding: 10px;
    border-radius: 20px;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
    position: relative;
  }

  .dog-card img {
    width: 100%;
    height: 60vh;
    object-fit: cover;
    border-radius: 15px;
  }

  .dog-card h3 {
    margin: 5px 0;
    color: #d94f85;
  }

  .dog-card p {
    margin: 0;
    font-size: 0.85em;
    color: #555;
  }

  .dog-card.selected {
    border: 3px solid #ff69b4;
  }

  .dog-card.sleeping {
    opacity: 0.8;
    filter: grayscale(10%) blur(0.5px);
    transition: 0.3s ease;
  }

 .dog-card.sleeping::before {
  content: "üí§ Kh√≤ kh√≤";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 1.4em;
  font-weight: bold;
  background: rgba(255, 255, 255, 0.8);
  padding: 8px 15px;
  border-radius: 20px;
  color: #d94f85;
  font-family: 'Comic Sans MS', cursive;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  z-index: 3;
  display: block;
}

/* ·∫®n ch·ªØ Kh√≤ kh√≤ khi ƒëang selected */
.dog-card.sleeping.selected::before {
  display: none;
}


  .dog-image-wrapper {
    position: relative;
  }

  .selected-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    background: rgba(255, 245, 250, 0.9);
    color: #d94f85;
    padding: 10px 22px;
    border-radius: 25px;
    font-size: 1.1em;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Comic Sans MS', cursive;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
    opacity: 0;
    transition: all 0.35s ease-in-out;
    z-index: 2;
    backdrop-filter: blur(2px);
  }

  .dog-card.selected .selected-overlay {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }

  .selected-overlay i {
    color: #e084b3;
    font-size: 1.3em;
    margin-right: 8px;
  }

  #submit-btn {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #ff69b4;
    color: white;
    padding: 12px 30px;
    border: none;
    border-radius: 30px;
    font-size: 1.2em;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }

  #submit-btn:hover {
    background-color: #ff1493;
  }

  #selected-count {
    position: fixed;
    top: 20px;
    right: 50%;
    transform: translateX(50%);
    background: #ffecf4;
    color: #d94f85;
    padding: 10px 20px;
    border-radius: 30px;
    font-weight: bold;
    display: none;
  }

  #alert-box-container {
    position: fixed;
    top: -100px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    width: 90%;
    max-width: 400px;
    text-align: center;
    transition: top 0.5s ease, opacity 0.3s ease;
    opacity: 0;
  }

  #alert-box-container.show {
    top: 30px;
    opacity: 1;
    transform: translateX(-50%) scale(1.05);
  }

  #alert-box {
    background: #fff0f5;
    border: 2px solid #ffa8c5;
    color: #d94f85;
    font-size: 1em;
    font-weight: bold;
    border-radius: 25px;
    padding: 12px 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  #photoOverlay {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(0, 0, 0, 0.85);
    z-index: 99999;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #photoOverlay img {
    height: 80vh;
    object-fit: cover;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
  }

  .carousel-inner {
    border-radius: 20px;
    overflow: hidden;
  }

  #tapOverlayText {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2em;
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 6px rgba(0,0,0,0.8);
    opacity: 0.85;
    z-index: 100001;
    animation: pulseText 1.5s infinite;
    pointer-events: none;
    font-family: 'Comic Sans MS', cursive;
  }

  @keyframes pulseText {
    0%, 100% { opacity: 0.85; }
    50% { opacity: 0.4; }
  }
</style>

</head>
<body>

<!-- Overlay slider ·∫£nh ch·ª•p th·∫≠t -->
<div id="photoOverlay">
  <div id="carouselPhotos" class="carousel slide w-100" style="max-width: 900px;" data-bs-ride="carousel" data-bs-interval="2500">
    <div class="carousel-inner"></div>
  </div>

  <!-- D√íNG CH·ªÆ CH·∫†M V√ÄO M√ÄN H√åNH -->
  <div id="tapOverlayText"> Ch·∫°m v√†o m√†n h√¨nh ƒë·ªÉ ti·∫øp t·ª•c</div>
</div>


<h1>üì∏ Ch·ªçn c√°c b√© iu ƒë·ªÉ ch·ª•p ·∫£nh</h1>

<div><input type="text" id="search-input" placeholder="Nh·∫≠p t√™n b√© c√∫n..." /></div>
<div id="seat-info">V·ªã tr√≠ ƒëang t·∫£i...</div>

<div style="margin: 30px auto 20px; font-size: 1.1em; color: #d94f85; font-weight: bold;">
  D∆∞·ªõi ƒë√¢y l√† danh s√°ch c√°c b√© c√∫n ƒëang ch·ªù ƒë∆∞·ª£c ch·ªçn n√®!
</div>

<div id="dog-list"></div>

<!-- Alert -->
<div id="alert-box-container">
  <div id="alert-box" class="alert alert-success" role="alert">
    <i class="fa-solid fa-circle-check me-2"></i>
    <span id="alert-message">ƒê√£ g·ª≠i y√™u c·∫ßu!</span>
  </div>
</div>

<!-- N√∫t ch·ªët -->
<button id="submit-btn">
  <i class="fa-solid fa-dog me-2"></i> Ch·ªët c√°c b√© iu üíñ
</button>

<div id="selected-count">ƒê√£ ch·ªçn: 0 b√©</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBNB1acbPtKox8eTjth3FtWuDOLhueRIys",
    authDomain: "dogs-be72b.firebaseapp.com",
    databaseURL: "https://dogs-be72b-default-rtdb.firebaseio.com",
    projectId: "dogs-be72b",
    storageBucket: "dogs-be72b.appspot.com",
    messagingSenderId: "1003873040746",
    appId: "1:1003873040746:web:607f4ff587afc430d3cd13"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const dogList = document.getElementById("dog-list");
  const searchInput = document.getElementById("search-input");
  const submitBtn = document.getElementById("submit-btn");
  const selectedCount = document.getElementById("selected-count");
  const seatInfo = document.getElementById("seat-info");
  const alertBox = document.getElementById("alert-box");
  const alertMessage = document.getElementById("alert-message");

  let selectedDogs = [];
  let allDogs = [];

  function updateSelectedCount() {
    selectedCount.style.display = selectedDogs.length > 0 ? "block" : "none";
    selectedCount.textContent = `ƒê√£ ch·ªçn: ${selectedDogs.length} b√©`;
  }

  function renderDogs(filter = "") {
    dogList.innerHTML = "";
    allDogs
      .filter(d => d.name.toLowerCase().includes(filter.toLowerCase()))
      .forEach(dog => {
        const div = document.createElement("div");
        div.className = "dog-card";
        div.dataset.name = dog.name;
        if (selectedDogs.includes(dog.name)) div.classList.add("selected");
        if (dog.status !== "play") div.classList.add("sleeping");

      div.innerHTML = `
  <div class="dog-image-wrapper">
    <img src="${dog.image}" alt="${dog.name}" />
    <div class="selected-overlay">
      <i class="fa-solid fa-check-circle me-2"></i> ƒê√£ ch·ªçn
    </div>
  </div>
  <h3>${dog.name}</h3>
  <p>Gi·ªëng: ${dog.breed}</p>
`;



      div.addEventListener("click", () => {
  const dogName = dog.name;

  if (selectedDogs.includes(dogName)) {
    selectedDogs = selectedDogs.filter(n => n !== dogName);
    div.classList.remove("selected");
    updateSelectedCount();
    return;
  }

  if (selectedDogs.length >= 3) {
    showBootstrapAlert("üêæ B·∫°n ch·ªâ ƒë∆∞·ª£c ch·ªçn t·ªëi ƒëa 3 b√© nha!", "warning");
    return;
  }

 if (dog.status !== "play") {
  // Ki·ªÉm tra s·ªë b√© ƒëang ng·ªß ƒë√£ ch·ªçn
  const selectedSleepingCount = selectedDogs.filter(name => {
    const d = allDogs.find(dog => dog.name === name);
    return d && d.status !== "play";
  }).length;

  if (selectedSleepingCount >= 1) {
    showBootstrapAlert("üò¥ B·∫°n ch·ªâ ƒë∆∞·ª£c ch·ªçn 1 b√© ƒëang ng·ªß th√¥i nha!", "warning");
    return;
  }

  // Hi·ªán modal x√°c nh·∫≠n
  const modalLabel = document.getElementById("sleepModalLabel");
  const modalBody = document.getElementById("sleepModalBody");
  const confirmSleepBtn = document.getElementById("confirmSleepBtn");

  modalLabel.textContent = `üí§ B√© "${dogName}" ƒëang ng·ªß`;
  modalBody.innerHTML = `B·∫°n v·∫´n mu·ªën ch·ªçn b√© <strong>${dogName}</strong> d√π ƒëang kh√≤ kh√≤ kh√¥ng?`;

  const bsModal = new bootstrap.Modal(document.getElementById("sleepModal"));
  bsModal.show();

  confirmSleepBtn.onclick = () => {
    selectedDogs.push(dogName);
    div.classList.add("selected");
    updateSelectedCount();
    bsModal.hide();
  };

  return;
}

  selectedDogs.push(dogName);
  div.classList.add("selected");
  updateSelectedCount();
});


        dogList.appendChild(div);
      });
  }

  function getSeatFromHash() {
    const hash = window.location.hash.toLowerCase();
    const match = hash.match(/^#\/?([lr])(\d)$/);
    if (match) {
      const side = match[1] === "r" ? "B√™n ph·∫£i" : "B√™n tr√°i";
      const table = "B√†n " + match[2];
      return { side, table };
    }
    return null;
  }

  function updateSeatDisplay() {
    const seat = getSeatFromHash();
    if (seat) {
      seatInfo.textContent = `V·ªã tr√≠ c·ªßa b·∫°n: ${seat.side} - ${seat.table}`;
    } else {
      seatInfo.textContent = "V·ªã tr√≠ ch∆∞a x√°c ƒë·ªãnh t·ª´ ƒë∆∞·ªùng link!";
    }
  }

 function showBootstrapAlert(message, type = "success", duration = 3000) {
  const container = document.getElementById("alert-box-container");
  const alertBox = document.getElementById("alert-box");
  const alertMessage = document.getElementById("alert-message");

  alertMessage.textContent = message; // ‚úÖ G√°n ƒë√∫ng ch·ªó!

  // M√†u s·∫Øc theo lo·∫°i
  if (type === "warning") {
    alertBox.style.backgroundColor = "#fff8e1";
    alertBox.style.borderColor = "#ffc107";
    alertBox.style.color = "#b66f00";
  } else if (type === "danger") {
    alertBox.style.backgroundColor = "#ffe0e0";
    alertBox.style.borderColor = "#ff6b6b";
    alertBox.style.color = "#c0392b";
  } else {
    alertBox.style.backgroundColor = "#fff0f5";
    alertBox.style.borderColor = "#ffa8c5";
    alertBox.style.color = "#d94f85";
  }

  container.classList.add("show");

  setTimeout(() => {
    container.classList.remove("show");
  }, duration);
}


  db.ref("dogs").on("value", snapshot => {
    const data = snapshot.val();
    allDogs = Object.values(data || {}).sort((a, b) => {
      if (a.status === "play" && b.status !== "play") return -1;
      if (a.status !== "play" && b.status === "play") return 1;
      return a.name.localeCompare(b.name);
    });
    renderDogs(searchInput.value);
  });

  searchInput.addEventListener("input", () => renderDogs(searchInput.value));
  window.addEventListener("hashchange", updateSeatDisplay);
  window.addEventListener("DOMContentLoaded", updateSeatDisplay);

  submitBtn.addEventListener("click", () => {
  db.ref("lastSelectTime").once("value").then(snapshot => {
    const lastTimestamp = snapshot.val();
    const now = Date.now();

    if (lastTimestamp && now - lastTimestamp < 900000) {
      // S·ª≠a l·ªói s·ªë √¢m
      let wait = 900 - Math.floor((now - lastTimestamp) / 1000); // 10 ph√∫t = 600s
      wait = Math.max(wait, 0);
      const min = Math.floor(wait / 60);
      const sec = wait % 60;
      showBootstrapAlert(`‚è≥ Vui l√≤ng quay l·∫°i sau ${min} ph√∫t ${sec} gi√¢y nha!`, "warning");
      return;
    }

    const seatFromHash = getSeatFromHash() || { side: "Kh√¥ng r√µ", table: "Kh√¥ng r√µ" };
    if (selectedDogs.length === 0) {
      showBootstrapAlert("‚ùó B·∫°n ch∆∞a ch·ªçn b√© c√∫n n√†o c·∫£!", "danger");
      return;
    }

    const nowDate = new Date();
    const timeStr = `${nowDate.getHours()}h${nowDate.getMinutes()}p`;

    const selectedAwake = [];
    const selectedSleeping = [];

    selectedDogs.forEach(name => {
      const dog = allDogs.find(d => d.name === name);
      if (!dog) return;
      if (dog.status === "play") {
        selectedAwake.push(name);
      } else {
        selectedSleeping.push(name);
      }
    });

    let message = `‚è∞ Th·ªùi gian: ${timeStr}\nüìç V·ªã tr√≠: ${seatFromHash.side} - ${seatFromHash.table}\n`;

    if (selectedAwake.length > 0) {
      message += `üê∂ B√© ƒëang ch∆°i: ${selectedAwake.join(", ")}\n`;
    }
    if (selectedSleeping.length > 0) {
      message += `üò¥ B√© ƒëang ng·ªß (kh√°ch v·∫´n mu·ªën order): ${selectedSleeping.join(", ")}`;
    }

    const encodedMsg = encodeURIComponent(message);
    const data = { selectedDogs, time: timeStr, seat: seatFromHash };

    db.ref("photoRequests").push(data)
      .then(() => {
        db.ref("lastSelectTime").set(firebase.database.ServerValue.TIMESTAMP);
        showBootstrapAlert(`üéâ B·∫°n ƒë√£ ch·ªët: ${selectedDogs.join(", ")}. Nh√¢n vi√™n s·∫Ω ƒë·∫øn h·ªó tr·ª£ b·∫°n sau v√†i ph√∫t nh√© ^^`, "success", 5000);
        selectedDogs = [];
        renderDogs(searchInput.value);
        updateSelectedCount();

        fetch(`https://hihihi-cyan.vercel.app/api/send?text=${encodedMsg}`)
          .then(res => res.json())
          .then(json => console.log("‚úÖ ƒê√£ g·ª≠i Telegram:", json))
          .catch(err => console.error("‚ùå L·ªói g·ª≠i Telegram:", err));
      })
      .catch(err => {
        console.error("‚ùå L·ªói khi l∆∞u Firebase:", err);
        showBootstrapAlert("‚ö†Ô∏è L·ªói khi g·ª≠i th√¥ng tin ch·ªët ·∫£nh.", "danger");
      });
  });
});

// Giao di·ªán ·∫£nh ƒë·∫ßu trang
const photoUrls = [
  "image/slide6.jpg",
  "image/slide2.jpg",
  "image/slide3.jpg",
  "image/slide4.jpg",
  "image/slide5.jpg"
];

const carouselInner = document.querySelector("#carouselPhotos .carousel-inner");
const overlay = document.getElementById("photoOverlay");

photoUrls.forEach((url, idx) => {
  const div = document.createElement("div");
  div.className = "carousel-item" + (idx === 0 ? " active" : "");
  div.innerHTML = `<img src="${url}" class="d-block w-100" alt="·∫¢nh ch·ª•p">`;
  carouselInner.appendChild(div);
});

overlay.addEventListener("click", () => {
  document.getElementById("tapOverlayText")?.remove();
  overlay.classList.add("fade");
  setTimeout(() => overlay.remove(), 500);
});

setTimeout(() => {
  document.getElementById("tapOverlayText")?.remove();
  if (document.body.contains(overlay)) overlay.click();
}, 8000);


</script>
<!-- Modal x√°c nh·∫≠n ch·ªçn b√© ƒëang ng·ªß -->
<div class="modal fade" id="sleepModal" tabindex="-1" aria-labelledby="sleepModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 20px;">
      <div class="modal-header bg-warning-subtle">
        <h5 class="modal-title" id="sleepModalLabel">üí§ B√© ƒëang ng·ªß</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
      </div>
      <div class="modal-body text-start" id="sleepModalBody">
        <!-- N·ªôi dung modal s·∫Ω ƒë∆∞·ª£c thay ƒë·ªïi ƒë·ªông -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Th√¥i ƒë·ªÉ b√© ngh·ªâ</button>
        <button type="button" class="btn btn-pink" id="confirmSleepBtn" style="background-color: #ff69b4; color: white;">V·∫´n ch·ªçn b√© </button>
      </div>
    </div>
  </div>
</div>

</body>
</html>
