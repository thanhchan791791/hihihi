<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ch·ªçn ch√≥ ch·ª•p ·∫£nh</title>

  <!-- Bootstrap + FontAwesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
  body {
    font-family: 'Comic Sans MS', cursive;
    background: linear-gradient(to bottom, #fffafc, #ffeef5);
    margin: 0;
    padding: 20px 20px 100px;
    text-align: center;
  }
.language-buttons .btn.active {
  background-color: #ff69b4;
  color: white;
}

  h1 {
    font-size: 2em;
    color: #ff69b4;
    margin-bottom: 10px;
  }
#view-photos-btn {
  display: inline-block;
  margin-top: 10px;
  padding: 10px 25px;
  font-size: 1em;
  font-weight: bold;
  border-radius: 30px;
  background-color: #fff0f7;
  color: #d94f85;
  border: 2px solid #ff69b4;
  box-shadow: 0 4px 10px rgba(255, 105, 180, 0.2);
  transition: all 0.3s ease;
  text-decoration: none;
}

#view-photos-btn:hover {
  background-color: #ff69b4;
  color: white;
  transform: scale(1.05);
}

  #search-input {
    width: 90%;
    max-width: 400px;
    padding: 12px 20px;
    font-size: 1em;
    border-radius: 30px;
    border: 2px solid #ffd6e6;
    background-color: #fff0f7;
    color: #d94f85;
  }

  #seat-info {
    margin-top: 10px;
    font-weight: bold;
    color: #d94f85;
    font-size: 1.1em;
  }

  #dog-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
  }

  .dog-card {
    background: #fff0f5;
    padding: 10px;
    border-radius: 20px;
    box-shadow: 0 0 8px rgba(0,0,0,0.1);
    position: relative;
  }
.language-buttons {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 15px;
}

.language-buttons .btn {
  font-size: 1em;
  font-weight: bold;
  padding: 10px 20px;
  border-radius: 30px;
  border: 2px solid #ff69b4;
  background-color: #fff0f7;
  color: #d94f85;
  transition: all 0.3s ease;
  box-shadow: 0 4px 10px rgba(255, 105, 180, 0.2);
}
.btn-view-photos {
  font-size: 1.3em;
  font-weight: bold;
  padding: 14px 32px;
  border-radius: 30px;
  background: linear-gradient(to right, #ff9ac9, #ff69b4);
  color: white;
  border: none;
  box-shadow: 0 6px 15px rgba(255, 105, 180, 0.5);
  transition: all 0.3s ease;
  letter-spacing: 0.5px;
  text-transform: none; /* ‚úÖ ch·ªØ th∆∞·ªùng */
  text-shadow: 1px 1px 3px rgba(0,0,0,0.3); /* d·ªÖ ƒë·ªçc h∆°n */
}

.btn-view-photos i {
  animation: bounceIcon 1.5s infinite;
}

.btn-view-photos:hover {
  background: linear-gradient(to right, #ff69b4, #ff1493);
  transform: scale(1.05);
  box-shadow: 0 8px 20px rgba(255, 105, 180, 0.6);
}

@keyframes bounceIcon {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-4px); }
}

.language-buttons .btn:hover {
  background-color: #ff69b4;
  color: white;
}

  .dog-card img {
    width: 100%;
    height: 60vh;
    object-fit: cover;
    border-radius: 15px;
  }

  .dog-card h3 {
    margin: 5px 0;
    color: #d94f85;
  }
.slide-section {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.5s ease, padding 0.5s ease;
  padding: 0;
}

.slide-section.show {
  max-height: 300px;
  padding: 20px 0;
}

  .dog-card p {
    margin: 0;
    font-size: 0.85em;
    color: #555;
  }

  .dog-card.selected {
    border: 3px solid #ff69b4;
  }

  .dog-card.sleeping {
    opacity: 0.8;
    filter: grayscale(10%) blur(0.5px);
    transition: 0.3s ease;
  }

  .dog-card.sleeping::before {
    content: "üí§ Kh√≤ kh√≤";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.4em;
    font-weight: bold;
    background: rgba(255, 255, 255, 0.8);
    padding: 8px 15px;
    border-radius: 20px;
    color: #d94f85;
    font-family: 'Comic Sans MS', cursive;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    z-index: 3;
    display: block;
  }

  .dog-card.sleeping.selected::before {
    display: none;
  }

  .dog-image-wrapper {
    position: relative;
  }

  .selected-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    background: rgba(255, 245, 250, 0.9);
    color: #d94f85;
    padding: 10px 22px;
    border-radius: 25px;
    font-size: 1.1em;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Comic Sans MS', cursive;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
    opacity: 0;
    transition: all 0.35s ease-in-out;
    z-index: 2;
    backdrop-filter: blur(2px);
  }

  .dog-card.selected .selected-overlay {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }

  .selected-overlay i {
    color: #e084b3;
    font-size: 1.3em;
    margin-right: 8px;
  }

  #submit-btn {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #ff69b4;
    color: white;
    padding: 12px 30px;
    border: none;
    border-radius: 30px;
    font-size: 1.2em;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }

  #submit-btn:hover {
    background-color: #ff1493;
  }

  #selected-count {
    position: fixed;
    top: 20px;
    right: 50%;
    transform: translateX(50%);
    background: #ffecf4;
    color: #d94f85;
    padding: 10px 20px;
    border-radius: 30px;
    font-weight: bold;
    display: none;
  }

  #alert-box-container {
    position: fixed;
    top: -100px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    width: 90%;
    max-width: 400px;
    text-align: center;
    transition: top 0.5s ease, opacity 0.3s ease;
    opacity: 0;
  }

  #alert-box-container.show {
    top: 30px;
    opacity: 1;
    transform: translateX(-50%) scale(1.05);
  }

  #alert-box {
    background: #fff0f5;
    border: 2px solid #ffa8c5;
    color: #d94f85;
    font-size: 1em;
    font-weight: bold;
    border-radius: 25px;
    padding: 12px 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  #photoOverlay {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(0, 0, 0, 0.85);
    z-index: 99999;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #photoOverlay img {
    height: 80vh;
    object-fit: cover;
    border-radius: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
  }

  .carousel-inner {
    border-radius: 20px;
    overflow: hidden;
  }
.section-spacing {
  margin-bottom: 30px; /* üëà b·∫°n c√≥ th·ªÉ ƒë·ªïi s·ªë n√†y n·∫øu mu·ªën g·∫ßn/h∆°i xa */
}

  #tapOverlayText {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2em;
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 6px rgba(0,0,0,0.8);
    opacity: 0.85;
    z-index: 100001;
    animation: pulseText 1.5s infinite;
    pointer-events: none;
    font-family: 'Comic Sans MS', cursive;
  }

  @keyframes pulseText {
    0%, 100% { opacity: 0.85; }
    50% { opacity: 0.4; }
  }
</style>
</head>
<body>
<!-- Overlay slider ·∫£nh ch·ª•p th·∫≠t -->
<div id="photoOverlay">
  <div id="carouselPhotos" class="carousel slide w-100" style="max-width: 900px;" data-bs-ride="carousel" data-bs-interval="2500" data-bs-wrap="true">
    <div class="carousel-inner"></div>
  </div>
  <!-- D√íNG CH·ªÆ CH·∫†M V√ÄO M√ÄN H√åNH -->
  <div id="tapOverlayText" data-i18n="tap_screen">Ch·∫°m v√†o m√†n h√¨nh ƒë·ªÉ ti·∫øp t·ª•c</div>
</div>

<h1 data-i18n="title">üì∏ Ch·ªçn c√°c b√© iu ƒë·ªÉ ch·ª•p ·∫£nh</h1>
<!-- N√∫t xem ·∫£nh kh√°ch -->
<!-- Nh√≥m 2 n√∫t xem ·∫£nh kh√°ch -->
<div class="d-flex justify-content-center gap-3 section-spacing">
  <button id="toggleGuestInput" class="btn btn-view-photos">
    <i class="fa-solid fa-image me-2"></i> Xem ·∫£nh kh√°ch
  </button>

  <button id="randomAlbumBtn" class="btn btn-view-photos" style="display: none; background: linear-gradient(to right, #ffb3d9, #ff66a3);">
    <i class="fa-solid fa-shuffle me-2"></i> Xem album ng·∫´u nhi√™n
  </button>
</div>


<!-- Kh·ªëi nh·∫≠p t√™n v√† m√£ QR (·∫©n ban ƒë·∫ßu) -->
<div id="guestLookupSection" class="slide-section text-center">
  <input type="text" id="guestNameInput" placeholder="Nh·∫≠p t√™n b·∫°n ƒë·ªÉ xem ·∫£nh"
    style="padding: 10px 20px; border-radius: 30px; border: 2px solid #ffd6e6; background-color: #fff0f7; color: #d94f85; max-width: 400px; width: 80%;" />
  <button onclick="xemAlbum()" style="margin-left: 10px; padding: 10px 25px; border-radius: 30px; background-color: #ff69b4; color: white; border: none; font-weight: bold;">
    üîç T√¨m ·∫£nh
  </button>
  <p id="errorText" style="color: red; margin-top: 10px;"></p>

 <div id="qrContainer" class="slide-section">

    <p>M√£ QR d·∫´n t·ªõi album c·ªßa b·∫°n:</p>
    <div id="qrcode"></div>
  </div>
</div>


<div class="language-buttons section-spacing">
  <button id="lang-vi" class="btn">üáªüá≥ Ti·∫øng Vi·ªát</button>
  <button id="lang-en" class="btn">üá∫üá∏ English</button>
</div>

<div>
  <input type="text" id="search-input" placeholder="Nh·∫≠p t√™n, gi·ªëng ho·∫∑c t√≠nh c√°ch b√© c√∫n..." data-i18n-placeholder="search_placeholder" />
</div>

<ul id="suggestion-list" style="list-style: none; padding-left: 0; margin-top: 10px; text-align: left; max-width: 400px; margin-inline: auto;"></ul>

<div id="seat-info" data-i18n="seat_loading">V·ªã tr√≠ ƒëang t·∫£i...</div>

<div style="margin: 30px auto 20px; font-size: 1.1em; color: #d94f85; font-weight: bold;" data-i18n="dog_list_intro">
  D∆∞·ªõi ƒë√¢y l√† danh s√°ch c√°c b√© c√∫n ƒëang ch·ªù ƒë∆∞·ª£c ch·ªçn n√®!
</div>

<div id="dog-list"></div>

<!-- Alert -->
<div id="alert-box-container">
  <div id="alert-box" class="alert alert-success" role="alert">
    <i class="fa-solid fa-circle-check me-2"></i>
    <span id="alert-message">ƒê√£ g·ª≠i y√™u c·∫ßu!</span>
  </div>
</div>

<!-- N√∫t ch·ªët -->
<button id="submit-btn">
  <i class="fa-solid fa-dog me-2"></i>
  <span data-i18n="submit_button">Ch·ªët c√°c b√© iu üíñ</span>
</button>

<div id="selected-count">ƒê√£ ch·ªçn: 0 b√©</div>

<!-- Modal x√°c nh·∫≠n ch·ªçn b√© ƒëang ng·ªß -->
<div class="modal fade" id="sleepModal" tabindex="-1" aria-labelledby="sleepModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius: 20px;">
      <div class="modal-header bg-warning-subtle">
        <h5 class="modal-title" id="sleepModalLabel">üí§ B√© ƒëang ng·ªß</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
      </div>
      <div class="modal-body text-start" id="sleepModalBody">
        <!-- N·ªôi dung modal s·∫Ω ƒë∆∞·ª£c thay ƒë·ªïi ƒë·ªông -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="modal_cancel">Th√¥i ƒë·ªÉ b√© ngh·ªâ</button>
        <button type="button" class="btn btn-pink" id="confirmSleepBtn" style="background-color: #ff69b4; color: white;" data-i18n="modal_confirm">V·∫´n ch·ªçn b√©</button>
      </div>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

<!-- SCRIPT QU·∫¢N L√ù NG√îN NG·ªÆ -->
<script>
const LANGS = {
  vi: {
    title: "üì∏ Ch·ªçn c√°c b√© iu ƒë·ªÉ ch·ª•p ·∫£nh",
    tap_screen: "Ch·∫°m v√†o m√†n h√¨nh ƒë·ªÉ ti·∫øp t·ª•c",
    search_placeholder: "Nh·∫≠p t√™n, gi·ªëng ho·∫∑c t√≠nh c√°ch b√© c√∫n...",
    seat_loading: "V·ªã tr√≠ ƒëang t·∫£i...",
    dog_list_intro: "D∆∞·ªõi ƒë√¢y l√† danh s√°ch c√°c b√© c√∫n ƒëang ch·ªù ƒë∆∞·ª£c ch·ªçn n√®!",
    submit_button: "Ch·ªët c√°c b√© iu üíñ",
    modal_cancel: "Th√¥i ƒë·ªÉ b√© ngh·ªâ",
    modal_confirm: "V·∫´n ch·ªçn b√©",
    selected_count: "ƒê√£ ch·ªçn: {count} b√©",
    selected: "ƒê√£ ch·ªçn"
  },
  en: {
    title: "üì∏ Choose your favorite dogs to take pictures",
    tap_screen: "Tap the screen to continue",
    search_placeholder: "Enter dog name, breed, or personality...",
    seat_loading: "Loading seat info...",
    dog_list_intro: "Below is the list of dogs waiting to be selected!",
    submit_button: "Confirm selected dogs üíñ",
    modal_cancel: "Let the dog sleep",
    modal_confirm: "Still select the dog",
    selected_count: "Selected: {count} dogs",
    selected: "Selected"
  }
};



let currentLang = localStorage.getItem("lang");

if (!currentLang) {
  const browserLang = navigator.language.toLowerCase();
  currentLang = browserLang.startsWith("vi") ? "vi" : "en";
  localStorage.setItem("lang", currentLang);
}

// D·ªãch n·ªôi dung theo key v√† ng√¥n ng·ªØ hi·ªán t·∫°i
function t(key) {
  return LANGS[currentLang]?.[key] || key;
}

// G√°n vƒÉn b·∫£n cho c√°c ph·∫ßn t·ª≠ c√≥ thu·ªôc t√≠nh data-i18n ho·∫∑c data-i18n-placeholder
function applyLanguage() {
  document.querySelectorAll("[data-i18n]").forEach(el => {
    el.innerText = t(el.dataset.i18n);
  });

  document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
    el.setAttribute("placeholder", t(el.dataset.i18nPlaceholder));
  });
}
function updateActiveLangButton() {
  document.getElementById("lang-vi").classList.toggle("active", currentLang === "vi");
  document.getElementById("lang-en").classList.toggle("active", currentLang === "en");
}

document.addEventListener("DOMContentLoaded", () => {
  applyLanguage();
  updateActiveLangButton(); // ‚úÖ Th√™m d√≤ng n√†y

 document.getElementById("lang-en").addEventListener("click", () => {
  currentLang = "en";
  localStorage.setItem("lang", "en");
  applyLanguage();
    updateActiveLangButton(); // ‚úÖ Th√™m d√≤ng n√†y

  renderDogs(searchInput.value); // ‚úÖ C·∫≠p nh·∫≠t l·∫°i text "Selected"
  updateSeatDisplay();           // ‚úÖ C·∫≠p nh·∫≠t l·∫°i v·ªã tr√≠ theo ng√¥n ng·ªØ
});


  document.getElementById("lang-vi").addEventListener("click", () => {
  currentLang = "vi";
  localStorage.setItem("lang", "vi");
  applyLanguage();
  updateActiveLangButton(); // ‚úÖ Th√™m d√≤ng n√†y

  renderDogs(searchInput.value); // ‚úÖ C·∫≠p nh·∫≠t l·∫°i text "ƒê√£ ch·ªçn"
  updateSeatDisplay();           // ‚úÖ C·∫≠p nh·∫≠t l·∫°i v·ªã tr√≠ theo ng√¥n ng·ªØ
});

});

</script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBNB1acbPtKox8eTjth3FtWuDOLhueRIys",
  authDomain: "dogs-be72b.firebaseapp.com",
  databaseURL: "https://dogs-be72b-default-rtdb.firebaseio.com",
  projectId: "dogs-be72b",
  storageBucket: "dogs-be72b.appspot.com",
  messagingSenderId: "1003873040746",
  appId: "1:1003873040746:web:607f4ff587afc430d3cd13"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const dogList = document.getElementById("dog-list");
const searchInput = document.getElementById("search-input");
const submitBtn = document.getElementById("submit-btn");
const selectedCount = document.getElementById("selected-count");
const seatInfo = document.getElementById("seat-info");
const alertMessage = document.getElementById("alert-message");

let selectedDogs = [];
let allDogs = [];

// Hi·ªÉn th·ªã c·∫£nh b√°o Bootstrap
function showBootstrapAlert(message, type = "success", duration = 3000) {
  const container = document.getElementById("alert-box-container");
  const alertBox = document.getElementById("alert-box");
  alertMessage.textContent = message;

  const colors = {
    success: ["#fff0f5", "#ffa8c5", "#d94f85"],
    warning: ["#fff8e1", "#ffc107", "#b66f00"],
    danger:  ["#ffe0e0", "#ff6b6b", "#c0392b"]
  };

  const [bg, border, color] = colors[type] || colors.success;
  alertBox.style.backgroundColor = bg;
  alertBox.style.borderColor = border;
  alertBox.style.color = color;

  container.classList.add("show");
  setTimeout(() => container.classList.remove("show"), duration);
}

function updateSelectedCount() {
  selectedCount.style.display = selectedDogs.length > 0 ? "block" : "none";
  selectedCount.textContent = t("selected_count").replace("{count}", selectedDogs.length);
}


function getSeatFromHash() {
  const hash = window.location.hash.toLowerCase();
  const match = hash.match(/^#\/?([lr])(\d)$/);
  if (match) {
    const side = match[1] === "r" ? (currentLang === "vi" ? "B√™n ph·∫£i" : "Right") : (currentLang === "vi" ? "B√™n tr√°i" : "Left");
    const table = (currentLang === "vi" ? "B√†n " : "Table ") + match[2];
    return { side, table };
  }
  return null;
}

function updateSeatDisplay() {
  const seat = getSeatFromHash();
  seatInfo.textContent = seat
    ? `${currentLang === "vi" ? "V·ªã tr√≠ c·ªßa b·∫°n" : "Your seat"}: ${seat.side} - ${seat.table}`
    : (currentLang === "vi" ? "V·ªã tr√≠ ch∆∞a x√°c ƒë·ªãnh t·ª´ ƒë∆∞·ªùng link!" : "Seat not determined from URL!");
}

function renderDogs(filter = "") {
  dogList.innerHTML = "";
  const keywords = filter.toLowerCase().split(/\s+/).filter(k => k);

  allDogs.filter(dog => {
    const text = `${dog.name} ${dog.breed} ${dog.trait || dog.personality || ""}`.toLowerCase();
    return keywords.every(k => text.includes(k));
  }).forEach(dog => {
    const div = document.createElement("div");
    div.className = "dog-card";
    div.dataset.name = dog.name;
    if (selectedDogs.includes(dog.name)) div.classList.add("selected");
    if (dog.status !== "play") div.classList.add("sleeping");

    div.innerHTML = `
      <div class="dog-image-wrapper">
        <img src="${dog.image}" alt="${dog.name}" />
<div class="selected-overlay"><i class="fa-solid fa-check-circle me-2"></i> ${t("selected")}</div>
      </div>
      <h3>${dog.name}</h3>
      <p>${currentLang === "vi" ? "Gi·ªëng" : "Breed"}: ${dog.breed}</p>
      <p>${currentLang === "vi" ? "T√≠nh c√°ch" : "Personality"}: ${dog.trait || dog.personality || (currentLang === "vi" ? "Ch∆∞a c·∫≠p nh·∫≠t" : "Not updated")}</p>
    `;

    div.addEventListener("click", () => {
      const dogName = dog.name;
      if (selectedDogs.includes(dogName)) {
        selectedDogs = selectedDogs.filter(n => n !== dogName);
        div.classList.remove("selected");
        updateSelectedCount();
        return;
      }

      if (selectedDogs.length >= 3) {
        showBootstrapAlert(currentLang === "vi" ? "üêæ B·∫°n ch·ªâ ƒë∆∞·ª£c ch·ªçn t·ªëi ƒëa 3 b√© nha!" : "üêæ You can only select up to 3 dogs!", "warning");
        return;
      }

      if (dog.status !== "play") {
        const selectedSleepingCount = selectedDogs.filter(name => {
          const d = allDogs.find(d => d.name === name);
          return d && d.status !== "play";
        }).length;

        if (selectedSleepingCount >= 1) {
          showBootstrapAlert(currentLang === "vi" ? "üò¥ B·∫°n ch·ªâ ƒë∆∞·ª£c ch·ªçn 1 b√© ƒëang ng·ªß th√¥i nha!" : "üò¥ You can only select 1 sleeping dog!", "warning");
          return;
        }

        const modalLabel = document.getElementById("sleepModalLabel");
        const modalBody = document.getElementById("sleepModalBody");
        const confirmSleepBtn = document.getElementById("confirmSleepBtn");

        modalLabel.textContent = `üí§ ${currentLang === "vi" ? "B√©" : "Dog"} "${dogName}" ${currentLang === "vi" ? "ƒëang ng·ªß" : "is sleeping"}`;
        modalBody.innerHTML = `${currentLang === "vi" ? "B·∫°n v·∫´n mu·ªën ch·ªçn" : "Do you still want to select"} <strong>${dogName}</strong>?`;

        const bsModal = new bootstrap.Modal(document.getElementById("sleepModal"));
        bsModal.show();

        confirmSleepBtn.onclick = () => {
          selectedDogs.push(dogName);
          div.classList.add("selected");
          updateSelectedCount();
          bsModal.hide();
        };
        return;
      }

      selectedDogs.push(dogName);
      div.classList.add("selected");
      updateSelectedCount();
    });

    dogList.appendChild(div);
  });
}

// X·ª≠ l√Ω kh·ªüi ƒë·ªông
db.ref("dogs").on("value", snapshot => {
  const data = snapshot.val();
  allDogs = Object.values(data || {}).sort((a, b) => {
    if (a.status === "play" && b.status !== "play") return -1;
    if (a.status !== "play" && b.status === "play") return 1;
    return a.name.localeCompare(b.name);
  });
  renderDogs(searchInput.value);
});

searchInput.addEventListener("input", () => renderDogs(searchInput.value));
window.addEventListener("hashchange", updateSeatDisplay);
window.addEventListener("DOMContentLoaded", updateSeatDisplay);

// N√∫t g·ª≠i y√™u c·∫ßu ch·ª•p ·∫£nh
submitBtn.addEventListener("click", () => {
  const todayStr = new Date().toISOString().split("T")[0];
  const lastSelectDate = localStorage.getItem("lastSelectDate");

  if (lastSelectDate === todayStr) {
    showBootstrapAlert(currentLang === "vi" ? "üìÖ B·∫°n ƒë√£ ch·ªët r·ªìi trong h√¥m nay. H·∫πn g·∫∑p l·∫°i b·∫°n v√†o ng√†y mai nh√©!" : "üìÖ You've already confirmed today. Come back tomorrow!", "warning", 5000);
    return;
  }

  db.ref("lastSelectTime").once("value").then(snapshot => {
    const lastTimestamp = snapshot.val();
    const now = Date.now();
    if (lastTimestamp && now - lastTimestamp < 1800000) {
      const wait = 1800 - Math.floor((now - lastTimestamp) / 1000);
      const min = Math.floor(wait / 60);
      const sec = wait % 60;
      const msg = currentLang === "vi"
        ? `‚è≥ Vui l√≤ng quay l·∫°i sau ${min} ph√∫t ${sec} gi√¢y nha!`
        : `‚è≥ Please come back in ${min} minutes ${sec} seconds!`;
      showBootstrapAlert(msg, "warning");
      return;
    }

    const seat = getSeatFromHash() || { side: "?", table: "?" };
    if (selectedDogs.length === 0) {
      showBootstrapAlert(currentLang === "vi" ? "‚ùó B·∫°n ch∆∞a ch·ªçn b√© c√∫n n√†o c·∫£!" : "‚ùó You haven't selected any dogs!", "danger");
      return;
    }

    const nowDate = new Date();
    const timeStr = `${nowDate.getHours()}h${nowDate.getMinutes()}p`;
    const awake = [], sleep = [];

    selectedDogs.forEach(name => {
      const dog = allDogs.find(d => d.name === name);
      if (!dog) return;
      (dog.status === "play" ? awake : sleep).push(name);
    });

    let msg = `‚è∞ ${currentLang === "vi" ? "Th·ªùi gian" : "Time"}: ${timeStr}\nüìç ${currentLang === "vi" ? "V·ªã tr√≠" : "Seat"}: ${seat.side} - ${seat.table}\n`;
    if (awake.length > 0) msg += `üê∂ ${currentLang === "vi" ? "B√© ƒëang ch∆°i" : "Awake"}: ${awake.join(", ")}\n`;
    if (sleep.length > 0) msg += `üò¥ ${currentLang === "vi" ? "B√© ƒëang ng·ªß (kh√°ch v·∫´n mu·ªën order)" : "Sleeping dogs (still selected)"}: ${sleep.join(", ")}`;

    db.ref("photoRequests").push({ selectedDogs, time: timeStr, seat })
      .then(() => {
        db.ref("lastSelectTime").set(firebase.database.ServerValue.TIMESTAMP);
        localStorage.setItem("lastSelectDate", todayStr);

        showBootstrapAlert(`${currentLang === "vi" ? "üéâ B·∫°n ƒë√£ ch·ªët" : "üéâ Confirmed"}: ${selectedDogs.join(", ")}`, "success", 5000);
        selectedDogs = [];
        renderDogs(searchInput.value);
        updateSelectedCount();

        const encodedMsg = encodeURIComponent(msg);
        fetch(`https://api.telegram.org/bot7807531189:AAGhMQ9jjew7Q9ywMDSTaGDy4Ns6XtPQUrI/sendMessage?chat_id=-4831972836&text=${encodedMsg}`);
      });
  });
});

// Hi·ªÉn th·ªã slider ·∫£nh n·ªÅn ban ƒë·∫ßu
const photoUrls = [
  "image/slide9.jpg",
  "image/slide6.jpg",
  "image/slide2.jpg",
  "image/slide3.jpg",
  "image/slide4.jpg",
  "image/slide5.jpg"
];
const carouselInner = document.querySelector("#carouselPhotos .carousel-inner");
const overlay = document.getElementById("photoOverlay");

photoUrls.forEach((url, idx) => {
  const div = document.createElement("div");
  div.className = "carousel-item" + (idx === 0 ? " active" : "");
  div.innerHTML = `<img src="${url}" class="d-block w-100" alt="·∫¢nh ch·ª•p">`;
  carouselInner.appendChild(div);
});

overlay.addEventListener("click", () => {
  document.getElementById("tapOverlayText")?.remove();
  overlay.classList.add("fade");
  setTimeout(() => overlay.remove(), 500);
});
   const isMaintenance = true; // ‚úÖ Chuy·ªÉn th√†nh true khi mu·ªën b·∫≠t b·∫£o tr√¨

  if (isMaintenance) {
    document.write(`
      <div style="display:flex;align-items:center;justify-content:center;height:100vh;background:#fff0f5;text-align:center;font-family:'Comic Sans MS', cursive;">
        <div>
          <h1 style="color:#ff69b4;font-size:2em;">üöß Trang ƒëang b·∫£o tr√¨</h1>
          <p style="color:#d94f85;">Cherry Pet Coffee ƒëang c·∫≠p nh·∫≠t ƒë·ªÉ ph·ª•c v·ª• b·∫°n t·ªët h∆°n.<br>Vui l√≤ng quay l·∫°i sau nh√©! üê∂üíï</p>
        </div>
      </div>
    `);
  }
  function normalizeName(input) {
  return input
    .normalize("NFD")                         // t√°ch d·∫•u ra
    .replace(/[\u0300-\u036f]/g, "")         // x√≥a d·∫•u
    .replace(/[^a-zA-Z0-9]/g, "")            // x√≥a k√Ω t·ª± ƒë·∫∑c bi·ªát, kho·∫£ng tr·∫Øng, d·∫•u -
    .toLowerCase();                          // chuy·ªÉn v·ªÅ ch·ªØ th∆∞·ªùng
}

 function xemAlbum() {
const rawInput = document.getElementById("guestNameInput").value;
const name = normalizeName(rawInput);
  const errorText = document.getElementById("errorText");

  if (!name) {
    errorText.innerText = "‚ùó Vui l√≤ng nh·∫≠p t√™n!";
    return;
  }

  db.ref("anhKhach/" + name).once("value").then(snapshot => {
    const data = snapshot.val();
    if (data) {
      const url = `https://thanhchan791791.github.io/hihihi/khoanh/?name=${encodeURIComponent(name)}`;
      window.location.href = url; // üëâ T·ª∞ ƒê·ªòNG CHUY·ªÇN TRANG
    } else {
      errorText.innerText = "‚ùå Kh√¥ng t√¨m th·∫•y t√™n trong h·ªá th·ªëng!";
    }
  }).catch(() => {
    errorText.innerText = "‚ö†Ô∏è C√≥ l·ªói k·∫øt n·ªëi!";
  });
}

document.getElementById("toggleGuestInput").addEventListener("click", () => {
  const guestSection = document.getElementById("guestLookupSection");
  const randomBtn = document.getElementById("randomAlbumBtn");

  guestSection.classList.toggle("show");
  randomBtn.style.display = guestSection.classList.contains("show") ? "inline-block" : "none";

  // Cu·ªôn nh·∫π ƒë·∫øn ph·∫ßn gi·ªØa sau khi hi·ªán
  if (guestSection.classList.contains("show")) {
    setTimeout(() => {
      guestSection.scrollIntoView({ behavior: "smooth", block: "center" });
    }, 300);
  }
});

// N√∫t xem album ·∫£nh kh√°ch ng·∫´u nhi√™n
document.getElementById("randomAlbumBtn").addEventListener("click", () => {
  db.ref("anhKhach").once("value").then(snapshot => {
    const data = snapshot.val();
    const names = Object.keys(data || {});
    if (names.length === 0) {
      showBootstrapAlert("‚ùå Kh√¥ng c√≥ ·∫£nh kh√°ch n√†o!", "warning");
      return;
    }

    const randomName = names[Math.floor(Math.random() * names.length)];
    const url = `https://thanhchan791791.github.io/hihihi/khoanh/?name=${encodeURIComponent(randomName)}`;
    window.location.href = url;
  }).catch(() => {
    showBootstrapAlert("‚ö†Ô∏è C√≥ l·ªói khi t·∫£i d·ªØ li·ªáu ·∫£nh kh√°ch!", "danger");
  });
});

</script>
</body>
</html>

