<!DOCTYPE html>
<html lang="vi">
<head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <title>Gợi Ý Chó Cưng</title>

      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

      <style>
            :root {
                  --primary-color: #a36173; /* Hồng đất */
                  --secondary-color: #d86c8f; /* Hồng đậm */
                  --light-bg: #fff8fc; /* Trắng kem */
                  --dark-text: #4a3a41; /* Nâu xám */
                  --transition-speed: 0.35s;
            }

            body {
                  font-family: 'Comic Sans MS', cursive;
                  background: linear-gradient(to bottom, #fffafc, #ffeef5);
                  margin: 0;
                  padding: 40px 20px;
                  text-align: center;
                  color: var(--dark-text);
                  display: flex;
                  flex-direction: column;
                  align-items: center;
                  min-height: 100vh;
            }
           
            h1 {
                  font-size: 2.2em;
                  color: var(--primary-color);
                  margin-bottom: 30px;
                  font-weight: bold;
            }
            
            /* --- LOGO STYLING ADDED --- */
            .logo-container {
                  margin-bottom: 20px;
            }

            .logo-container img {
                  width: 100%;
                  max-width: 150px; /* Điều chỉnh kích thước tối đa của logo */
                  height: auto;
                  border-radius: 50%; /* Tùy chọn: làm logo tròn */
                  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                  border: 4px solid var(--light-bg);
            }
            /* --------------------------- */

            .suggestion-container {
                  width: 100%;
                  max-width: 600px;
                  background: var(--light-bg);
                  padding: 30px 20px;
                  border-radius: 20px;
                  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
                  position: relative;
                  overflow: hidden; /* Quan trọng cho hiệu ứng slide */
            }

            /* --- Toggle Switch Styling (iOS style) --- */
            .toggle-container {
                  display: inline-flex;
                  background-color: #e9e9e9;
                  border-radius: 12px;
                  margin-bottom: 25px;
                  padding: 4px;
                  box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
            }

            .toggle-btn {
                  padding: 8px 18px;
                  border: none;
                  border-radius: 8px;
                  font-weight: bold;
                  cursor: pointer;
                  background-color: transparent;
                  color: var(--dark-text);
                  transition: all var(--transition-speed) ease-in-out;
                  position: relative;
                  z-index: 1;
            }

            .toggle-btn.active {
                  color: white;
                  background-color: var(--secondary-color);
                  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
            }

            /* --- Suggestion Content Transition --- */
            .suggestion-wrapper {
                  display: flex;
                  transition: transform var(--transition-speed) ease-in-out;
            }

            .suggestion-section {
                  flex-shrink: 0;
                  width: 100%;
                  transition: opacity var(--transition-speed) ease-in-out;
                  padding-top: 10px;
            }
            
            /* Class to shift the wrapper */
            .suggestion-wrapper.show-personality {
                  transform: translateX(-100%);
            }

            /* --- Suggestion Buttons --- */
            .btn-suggestion {
                  font-size: 1.05em;
                  font-weight: bold;
                  padding: 12px 22px;
                  border-radius: 30px;
                  background: linear-gradient(to right, var(--secondary-color), var(--primary-color));
                  color: white;
                  border: none;
                  box-shadow: 0 4px 10px rgba(216, 108, 143, 0.4);
                  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); /* Hiệu ứng nhấn mượt */
                  margin: 5px;
                  min-width: 110px;
            }

            .btn-suggestion:hover {
                  background: linear-gradient(to right, var(--primary-color), #8a4e61);
                  transform: translateY(-2px);
                  box-shadow: 0 6px 15px rgba(163, 97, 115, 0.6);
            }

            .btn-suggestion:active {
                  transform: scale(0.95);
                  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            }

            /* --- Other Elements --- */
            #seat-info {
                  margin-top: 20px;
                  font-weight: bold;
                  color: var(--dark-text);
                  font-size: 1.1em;
            }

            /* Pop-up xác nhận */
            #suggestionPopup {
                  position: fixed;
                  bottom: -150px;
                  left: 50%;
                  transform: translateX(-50%);
                  z-index: 9999;
                  width: 90%;
                  max-width: 400px;
                  background: var(--light-bg);
                  border-radius: 20px;
                  padding: 20px;
                  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                  transition: bottom 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Hiệu ứng bật lên spring */
            }
            #suggestionPopup.show-popup {
                  bottom: 20px;
            }
            .popup-message {
                  font-size: 1.1em;
                  font-weight: bold;
                  margin-bottom: 15px;
                  color: var(--primary-color);
            }
            .popup-buttons {
                  display: flex;
                  justify-content: center;
                  gap: 10px;
            }
            .popup-buttons button {
                  padding: 10px 20px;
                  border-radius: 20px;
                  border: none;
                  font-weight: bold;
                  cursor: pointer;
                  transition: transform 0.2s;
            }
            .popup-buttons #confirmSuggestBtn {
                  background-color: var(--secondary-color);
                  color: white;
            }
            .popup-buttons #cancelSuggestBtn {
                  background-color: #f0f0f0;
                  color: #555;
            }

            #alert-box-container {
                  position: fixed;
                  top: -100px;
                  left: 50%;
                  transform: translateX(-50%);
                  z-index: 9999;
                  width: 90%;
                  max-width: 400px;
                  text-align: center;
                  transition: top 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease;
                  opacity: 0;
            }

            #alert-box-container.show {
                  top: 30px;
                  opacity: 1;
                  transform: translateX(-50%) scale(1);
            }

            #alert-box {
                  background: var(--light-bg);
                  border: 2px solid #f7a3b8;
                  color: var(--primary-color);
                  font-size: 1em;
                  font-weight: bold;
                  border-radius: 25px;
                  padding: 12px 20px;
                  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }
      </style>
</head>
<body>
      
      <div class="logo-container">
            <img src="logocherry.png" alt="Logo Quán" />
      </div>

      <h1>Chọn đặc điểm cún cưng bạn muốn ôm hoặc chụp ảnh</h1>

      <div class="suggestion-container">
            <h2 style="font-size: 1.5em; color: var(--primary-color); font-weight: bold; margin-bottom: 20px;">Lựa chọn theo</h2>
            
            <div class="toggle-container">
                  <button class="toggle-btn active" id="toggleAppearance">Ngoại hình</button>
                  <button class="toggle-btn" id="togglePersonality">Tính cách</button>
            </div>
            
            <p style="margin-bottom: 25px; color: var(--dark-text); font-size: 0.9em;">Nhấn vào gợi ý để gửi yêu cầu đến nhân viên.</p>

            <div class="suggestion-wrapper" id="suggestionWrapper">
                  
                  <div class="suggestion-section" id="appearanceSection">
                        <div class="d-flex justify-content-center flex-wrap gap-3">
                              <button class="btn btn-suggestion" data-suggestion="chân dài" data-type="appearance">Chân Dài <i class="fa-solid fa-paw"></i></button>
                              <button class="btn btn-suggestion" data-suggestion="chân ngắn" data-type="appearance">Chân Ngắn <i class="fa-solid fa-dog"></i></button>
                              <button class="btn btn-suggestion" data-suggestion="ú nu" data-type="appearance">Ú Nu <i class="fa-solid fa-heart"></i></button>
                              <button class="btn btn-suggestion" data-suggestion="dễ thương" data-type="appearance">Dễ Thương <i class="fa-solid fa-face-grin-hearts"></i></button>
                              <button class="btn btn-suggestion" data-suggestion="trắng trẻo" data-type="appearance">Trắng Trẻo <i class="fa-solid fa-star"></i></button>
                        </div>
                  </div>

                  <div class="suggestion-section" id="personalitySection">
                        <div class="d-flex justify-content-center flex-wrap gap-3">
                              <button class="btn btn-suggestion" data-suggestion="ngoan hiền" data-type="personality">Ngoan, Hiền <i class="fa-solid fa-thumbs-up"></i></button>
                              <button class="btn btn-suggestion" data-suggestion="quậy phá" data-type="personality">Quậy Phá <i class="fa-solid fa-bomb"></i></button>
                              <button class="btn btn-suggestion" data-suggestion="quấn khách" data-type="personality">Quấn Khách <i class="fa-solid fa-hand-holding-heart"></i></button>
                              <button class="btn btn-suggestion" data-suggestion="khó chịu" data-type="personality">Khó Chịu <i class="fa-solid fa-face-angry"></i></button>
                        </div>
                  </div>

            </div> </div>

      <div id="seat-info">Vị trí đang tải...</div>

      <div id="alert-box-container">
            <div id="alert-box" class="alert alert-success" role="alert">
                  <i class="fa-solid fa-circle-check me-2"></i>
                  <span id="alert-message">Đã gửi yêu cầu!</span>
            </div>
      </div>

      <div id="suggestionPopup">
            <div class="popup-message">Bạn có chắc muốn gửi yêu cầu tìm bé có đặc điểm <span id="popupSuggestionText" style="color: var(--secondary-color);"></span> không?</div>
            <div class="popup-buttons">
                  <button id="cancelSuggestBtn">Hủy</button>
                  <button id="confirmSuggestBtn">Xác nhận</button>
            </div>
      </div>

      <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

      <script>
            const firebaseConfig = {
                  apiKey: "AIzaSyBNB1acbPtKox8eTjth3FtWuDOLhueRIys",
                  authDomain: "dogs-be72b.firebaseapp.com",
                  databaseURL: "https://dogs-be72b-default-rtdb.firebaseio.com",
                  projectId: "dogs-be72b",
                  storageBucket: "dogs-be72b.appspot.com",
                  messagingSenderId: "1003873040746",
                  appId: "1:1003873040746:web:607f4ff587afc430d3cd13"
            };
            firebase.initializeApp(firebaseConfig);
            // const db = firebase.database(); // Giữ lại nếu cần lưu trữ

            const suggestionPopup = document.getElementById('suggestionPopup');
            const popupSuggestionText = document.getElementById('popupSuggestionText');
            const confirmSuggestBtn = document.getElementById('confirmSuggestBtn');
            const cancelSuggestBtn = document.getElementById('cancelSuggestBtn');
            const seatInfo = document.getElementById("seat-info");
            const alertMessage = document.getElementById("alert-message");
            const suggestionWrapper = document.getElementById('suggestionWrapper');
            const toggleAppearance = document.getElementById('toggleAppearance');
            const togglePersonality = document.getElementById('togglePersonality');

            let currentSuggestion = null;
            let currentType = 'appearance';
            
            // --- Helper Functions ---
            
            function showBootstrapAlert(message, type = "success", duration = 3000) {
                  const container = document.getElementById("alert-box-container");
                  const alertBox = document.getElementById("alert-box");
                  alertMessage.textContent = message;

                  const colors = {
                        success: ["#fff8fc", "#f7a3b8", "#a36173"],
                        warning: ["#fef8e7", "#ffc107", "#b66f00"],
                        danger:   ["#ffe0e0", "#ff6b6b", "#c0392b"],
                        info: ["#e3f2fd", "#2196F3", "#1565C0"]
                  };

                  const [bg, border, color] = colors[type] || colors.success;
                  alertBox.style.backgroundColor = bg;
                  alertBox.style.borderColor = border;
                  alertBox.style.color = color;

                  container.classList.add("show");
                  setTimeout(() => container.classList.remove("show"), duration);
            }

            function getSeatFromHash() {
                  const hash = window.location.hash.toLowerCase();
                  const match = hash.match(/^#\/?([lr])(\d)$/);
                  if (match) {
                        const side = match[1] === "r" ? "Bên phải" : "Bên trái";
                        const table = `Bàn ${match[2]}`;
                        return { side, table };
                  }
                  return null;
            }

            function updateSeatDisplay() {
                  const seat = getSeatFromHash();
                  seatInfo.textContent = seat
                        ? `Vị trí của bạn: ${seat.side} - ${seat.table}`
                        : "Vị trí chưa xác định từ đường link!";
            }

            // --- Toggle Logic ---
            function setSelectionMode(mode) {
                  if (mode === 'personality') {
                        suggestionWrapper.classList.add('show-personality');
                        toggleAppearance.classList.remove('active');
                        togglePersonality.classList.add('active');
                  } else {
                        suggestionWrapper.classList.remove('show-personality');
                        toggleAppearance.classList.add('active');
                        togglePersonality.classList.remove('active');
                  }
                  currentType = mode;
            }

            toggleAppearance.addEventListener('click', () => setSelectionMode('appearance'));
            togglePersonality.addEventListener('click', () => setSelectionMode('personality'));


            // --- Event Listeners for Suggestions and Pop-up ---

            document.querySelectorAll('.btn-suggestion').forEach(button => {
                  button.addEventListener('click', () => {
                        currentSuggestion = button.dataset.suggestion;
                        currentType = button.dataset.type;
                        
                        // Định dạng lại tên gợi ý cho đẹp
                        const displaySuggestion = currentSuggestion.replace(/\b\w/g, char => char.toUpperCase()).replace(' ', ', ');

                        popupSuggestionText.textContent = `"${displaySuggestion}"`;
                        suggestionPopup.classList.add('show-popup');
                  });
            });

            confirmSuggestBtn.addEventListener('click', () => {
                  suggestionPopup.classList.remove('show-popup');
                  const suggestion = currentSuggestion;
                  const type = currentType === 'appearance' ? 'Ngoại hình' : 'Tính cách';
                  const seat = getSeatFromHash() || { side: "?", table: "?" };
                  const cooldown = 1800000; // 30 phút = 1800000 ms
                  const now = Date.now();
                  const lastSuggestionTime = localStorage.getItem("lastSuggestionTime");
                  const displaySuggestion = suggestion.replace(/\b\w/g, char => char.toUpperCase()).replace(' ', ', ');


                  if (lastSuggestionTime && (now - parseInt(lastSuggestionTime, 10) < cooldown)) {
                        const wait = (cooldown - (now - lastSuggestionTime)) / 1000;
                        const min = Math.floor(wait / 60);
                        const sec = Math.floor(wait % 60);
                        showBootstrapAlert(`⏳ Vui lòng đợi ${min} phút ${sec} giây trước khi gửi yêu cầu tìm bé khác!`, "warning", 5000);
                        return;
                  }

                  const msg = `vị trí ${seat.side} - ${seat.table} muốn tìm bé cún có đặc điểm (${type}): ${suggestion}.`;
                  const encodedMsg = encodeURIComponent(msg);

                  // Gửi tin nhắn đến Telegram
                  fetch(`https://api.telegram.org/bot7807531189:AAGhMQ9jjew7Q9ywMDSTaGDy4Ns6XtPQUrI/sendMessage?chat_id=-4831972836&text=${encodedMsg}`)
                        .then(response => {
                              if (response.ok) {
                                    localStorage.setItem("lastSuggestionTime", now.toString());
                                    showBootstrapAlert(` Yêu cầu tìm bé (${type}) ${displaySuggestion} của bạn đã được gửi. Nhân viên sẽ hỗ trợ bạn ngay!`, "success", 7000);
                              } else {
                                    showBootstrapAlert("⚠️ Lỗi: Không gửi được yêu cầu, vui lòng thử lại!", "danger");
                              }
                        })
                        .catch(() => {
                              showBootstrapAlert("⚠️ Lỗi kết nối, vui lòng thử lại!", "danger");
                        });
            });

            cancelSuggestBtn.addEventListener('click', () => {
                  suggestionPopup.classList.remove('show-popup');
            });

            window.addEventListener("hashchange", updateSeatDisplay);
            window.addEventListener("DOMContentLoaded", updateSeatDisplay);
      </script>
</body>
</html>
